let arr_dungeons = [
  {Name: "Sastasha", ID: 663},
  {Name: "The Tam-Tara Deepcroft", ID: 669},
  {Name: "Copperbell Mines", ID: 666},
  {Name: "Halatali", ID: 667},
  {Name: "The Thousand Maws of Toto-Rak", ID: 673},
  {Name: "Haukke Manor", ID: 670},
  {Name: "Brayflox's Longstop", ID: 674},
  {Name: "The Sunken Temple of Qarn", ID: 668},
  {Name: "Cutter's Cry", ID: 674},
  {Name: "The Stone Vigil", ID: 672},
  {Name: "Dzemael Darkhold", ID: 675},
  {Name: "The Aurum Vale", ID: 676},
  {Name: "Castrum Meridianum", ID: 678},
  {Name: "The Praetorium", ID: 679},
  {Name: "The Wanderer's Palace", ID: 665},
  {Name: "Amdapor Keep", ID: 671},
  {Name: "Pharos Sirius", ID: 873},
  {Name: "Copperbell Mines (Hard)", ID: 871},
  {Name: "Haukke Manor (Hard)", ID: 872},
  {Name: "The Lost City of Amdapor", ID: 897},
  {Name: "Halatali (Hard)", ID: 895},
  {Name: "Brayflox's Longstop (Hard)", ID: 896},
  {Name: "Hullbreaker Isle", ID: 993},
  {Name: "The Stone Vigil (Hard)", ID: 992},
  {Name: "The Tam-Tara Deepcroft (Hard)", ID: 991},
  {Name: "Snowcloak", ID: 1039},
  {Name: "Sastasha (Hard)", ID: 1038},
  {Name: "The Sunken Temple of Qarn (Hard)", ID: 1037},
  {Name: "The Keeper of the Lake", ID: 1072},
  {Name: "The Wanderer's Palace (Hard)", ID: 1071},
  {Name: "Amdapor Keep (Hard)", ID: 1070}
]

let hw_dungeons = [
  {Name: "The Dusk Vigil", ID: 1208},
  {Name: "Sohm Al", ID: 1209},
  {Name: "The Aery", ID: 1210},
  {Name: "The Vault", ID: 1211},
  {Name: "The Great Gubal Library", ID: 1212},
  {Name: "The Aetherochemical Research Facility", ID: 1213},
  {Name: "Neverreap", ID: 1214},
  {Name: "The Fractal Continuum", ID: 1215},
  {Name: "Saint Mocianne's Arboretum", ID: 1402},
  {Name: "Pharos Sirius (Hard)", ID: 1403},
  {Name: "The Antitower", ID: 1486},
  {Name: "The Lost City of Amdapor (Hard)", ID: 1487},
  {Name: "Sohr Khai", ID: 1599},
  {Name: "Hullbreaker Isle (Hard)", ID: 1600},
  {Name: "Xelphatol", ID: 1637},
  {Name: "The Great Gubal Library (Hard)", ID: 1638},
  {Name: "Baelsar's Wall", ID: 1686},
  {Name: "Sohm Al (Hard)", ID: 1687}
]

let sb_dungeons = [
  {Name: "The Sirensong Sea", ID: 1883},
  {Name: "Shisui of the Violet Tides", ID: 1884},
  {Name: "Bardam's Mettle", ID: 1885},
  {Name: "Doma Castle", ID: 1886},
  {Name: "Castrum Abania", ID: 1887},
  {Name: "Ala Mhigo", ID: 1888},
  {Name: "Kugane Castle", ID: 1889},
  {Name: "The Temple of the Fist", ID: 1890},
  {Name: "The Drowned City of Skalla", ID: 1988},
  {Name: "Hells' Lid", ID: 2021},
  {Name: "The Fractal Continuum (Hard)", ID: 2022},
  {Name: "The Swallow's Compass", ID: 2057},
  {Name: "Saint Mocianne's Arboretum (Hard)", ID: 2116},
  {Name: "The Burn", ID: 2115},
  {Name: "The Ghimlyt Dark", ID: 2162}
]

let shb_dungeons = [
  {Name: "Holminster Switch", ID: 2377},
  {Name: "Dohn Mheg", ID: 2378},
  {Name: "The Qitana Ravel", ID: 2379},
  {Name: "Malikah's Well", ID: 2380},
  {Name: "Mt. Gulg", ID: 2381},
  {Name: "Amaurot", ID: 2382},
  {Name: "The Twinning", ID: 2383},
  {Name: "Akadaemia Anyder", ID: 2384},
  {Name: "The Grand Cosmos", ID: 2440},
  {Name: "Anamnesis Anyder", ID: 2589},
  {Name: "The Heroes' Gauntlet", ID: 2618},
  {Name: "Matoya's Relict", ID: 2717},
  {Name: "Paglth'an", ID: 2849}
]

let arr_trials = [
  {Name: "The Bowl of Embers", ID: -1},
  {Name: "The Navel", ID: -1},
  {Name: "The Howling Eye", ID: -1},
  {Name: "Cape Westwind", ID: -1},
  {Name: "The Chrysalis", ID: 1067},
  {Name: "The Steps of Faith", ID: 1065},
  {Name: "A Relic Reborn: The Chimera", ID: -1},
  {Name: "A Relic Reborn: The Hydra", ID: -1},
  {Name: "Battle on the Big Bridge", ID: -1},
  {Name: "The Dragon's Neck", ID: -1},
  {Name: "Battle in the Big Keep", ID: 1066},
  {Name: "The Bowl of Embers (Hard)", ID: -1},
  {Name: "The Howling Eye (Hard)", ID: -1},
  {Name: "The Navel (Hard)", ID: -1},
  {Name: "Thornmarch (Hard)", ID: -1},
  {Name: "The Whorleater (Hard)", ID: -1},
  {Name: "The Striking Tree (Hard)", ID: -1},
  {Name: "Akh Afah Amphitheatre (Hard) 	", ID: -1},
  {Name: "Urth's Fount", ID: 1064}
]

let hw_trials = [
  {Name: "Thok ast Thok (Hard)", ID: -1},
  {Name: "The Limitless Blue (Hard) 	", ID: -1},
  {Name: "The Singularity Reactor", ID: -1},
  {Name: "The Final Steps of Faith", ID: -1},
  {Name: "Containment Bay S1T7", ID: -1},
  {Name: "Containment Bay P1T6", ID: -1},
  {Name: "Containment Bay Z1T9", ID: -1}
]

let sb_trials = [
  {Name: "The Pool of Tribute", ID: -1},
  {Name: "Emanation", ID: -1},
  {Name: "The Royal Menagerie", ID: -1},
  {Name: "Castrum Fluminis", ID: -1},
  {Name: "Kugane Ohashi", ID: 2236},
  {Name: "The Great Hunt", ID: -1},
  {Name: "The Jade Stoa", ID: -1},
  {Name: "Hells' Kier", ID: -1},
  {Name: "The Wreath of Snakes", ID: -1}
]

let shb_trials = [
  {Name: "The Dancing Plague", ID: -1},
  {Name: "The Crown of the Immaculate", ID: -1},
  {Name: "The Dying Gasp", ID: -1},
  {Name: "Cinder Drift", ID: -1},
  {Name: "The Seat of Sacrifice", ID: -1},
  {Name: "Castrum Marinum", ID: -1},
  {Name: "The Cloud Deck", ID: -1}
]

let arr_trials_ex = [
  {Name: "The Minstrel's Ballad: Ultima's Bane", ID: -1},
  {Name: "The Howling Eye (Extreme)", ID: 856},
  {Name: "The Navel (Extreme)", ID: 857},
  {Name: "The Bowl of Embers (Extreme)", ID: 855},
  {Name: "Thornmarch (Extreme)", ID: 894},
  {Name: "The Whorleater (Extreme)", ID: 893},
  {Name: "The Striking Tree (Extreme)", ID: 994},
  {Name: "Akh Afah Amphitheatre (Extreme)", ID: 1045}
]

let hw_trials_ex = [
  {Name: "The Limitless Blue (Extreme)", ID: 1220},
  {Name: "Thok ast Thok (Extreme)", ID: 1221},
  {Name: "The Minstrel's Ballad: Thordan's Reign 	", ID: 1400},
  {Name: "The Minstrel's Ballad: Nidhogg's Rage", ID: 1601},
  {Name: "Containment Bay S1T7 (Extreme)", ID: 1485},
  {Name: "Containment Bay P1T6 (Extreme)", ID: 1636},
  {Name: "Containment Bay Z1T9 (Extreme)", ID: 1685}
]

let sb_trials_ex = [
  {Name: "The Pool of Tribute (Extreme)", ID: 1902},
  {Name: "Emanation (Extreme)", ID: 1901},
  {Name: "The Minstrel's Ballad: Shinryu's Domain", ID: 1989},
  {Name: "The Minstrel's Ballad: Tsukuyomi's Pain", ID: 2060},
  {Name: "The Great Hunt (Extreme)", ID: 2109},
  {Name: "The Jade Stoa (Extreme)", ID: 2023},
  {Name: "Hells' Kier (Extreme)", ID: 2117},
  {Name: "The Wreath of Snakes (Extreme)", ID: 2165}
]

let shb_trials_ex = [
  {Name: "The Dancing Plague (Extreme)", ID: 2385},
  {Name: "The Crown of the Immaculate (Extreme)", ID: 2386},
  {Name: "Minstrel's Ballad: Hades's Elegy", ID: 2441},
  {Name: "Cinder Drift (Extreme)", ID: 2590},
  {Name: "Memoria Misera (Extreme)", ID: 2586},
  {Name: "The Seat of Sacrifice (Extreme)", ID:2621},
  {Name: "Castrum Marinum (Extreme)", ID: 2718},
  {Name: "The Cloud Deck (Extreme)", ID: 2846}
]

let arr_raids = [
  {Name: "Labyrinth of the Ancients", ID: 883},
  {Name: "Syrcus Tower", ID: 995},
  {Name: "The World of Darkness", ID: 1068},
  {Name: "The Binding Coil of Bahamut", ID: 747},
  {Name: "The Second Coil of Bahamut", ID: 887},
  {Name: "The Final Coil of Bahamut", ID: 1040}
]

let hw_raids = [
  {Name: "The Void Ark", ID: 1399},
  {Name: "The Weeping City of Mhach", ID: 1574},
  {Name: "Dun Scaith", ID: 1689},
  {Name: "Alexander: Gordias", ID: 1228},
  {Name: "Alexander: Midas", ID: 1476},
  {Name: "Alexander: The Creator", ID: 1639}
]

let sb_raids = [
  {Name: "The Royal City of Rabanastre 	", ID: 1992},
  {Name: "The Ridorana Lighthouse", ID: 2106},
  {Name: "The Orbonne Monastery", ID: 2164},
  {Name: "Omega: Deltascape", ID: 1895},
  {Name: "Omega: Sigmascape", ID: 2024},
  {Name: "Omega: Alphascape", ID: 2118}
]

let shb_raids = [
  {Name: "The Copied Factory", ID: 2443},
  {Name: "The Puppets' Bunker", ID: 2622},
  {Name: "The Tower at Paradigm's Breach", ID: 2847},
  {Name: "Eden's Gate", ID: 2409},
  {Name: "Eden's Verse", ID: 2591},
  {Name: "Eden's Promise", ID: 2719}
]

let arr_raids_s = [
  {Name: "The Second Coil of Bahamut (Savage)", ID: 1000}
]

let hw_raids_s = [
  {Name: "Alexander: Gordias (Savage)", ID: 1231},
  {Name: "Alexander: Midas (Savage)", ID: 1479},
  {Name: "Alexander: The Creator (Savage)", ID: 1642}
]

let sb_raids_s = [
  {Name: "Omega: Deltascape (Savage)", ID: 1898},
  {Name: "Omega: Sigmascape (Savage)", ID: 2027},
  {Name: "Omega: Alphascape (Savage)", ID: 2121},
  {Name: "The Unending Coil of Bahamut (Ultimate)", ID: 1993},
  {Name: "The Minstrel's Ballad: The Weapon's Refrain (Ultimate)", ID: 2107}
]

let shb_raids_s = [
  {Name: "Eden's Gate (Savage)", ID: 2412},
  {Name: "Eden's Verse (Savage)", ID: 2594},
  {Name: "Eden's Promise (Savage)", ID: 2722},
  {Name: "The Epic of Alexander (Ultimate)", ID: 2444}
]

let searchParams = new URLSearchParams(window.location.search)
if (!searchParams.has("id")) {
  $("#error").show()
  $("#error").html("<b>Error:</b> The URL must contain a character ID.")
  throw new Error();
}
let characterID = searchParams.get("id")

let achievements

function renderList(id, list) {
  let html = ""
    for (let i = 0; i < list.length; i++) {
      if (list[i]["ID"] == -1) {
        html += "<li>"
      } else if (achievements.has(list[i]["ID"])) {
        html += "<li style='color: green;'>"
      } else {
        html += "<li style='color: red;'>"
      }
      html += list[i]["Name"] + "</li>"
    }
    $(id).html(html)
}

$.ajax({
	url: "https://xivapi.com/character/" + characterID + "?data=AC",
	dataType: "json",
	success: function(data) {
    let character = data["Character"]
    achievements = new Map()
    for (let i = 0; i < data["Achievements"]["List"].length; i++) {
      achievements.set(data["Achievements"]["List"][i]["ID"], data["Achievements"]["List"][i]["Date"])
    }

		console.log(data)

    $("#c_name").html(character["Name"])

    if (!data["AchievementsPublic"]) {
      $("#error").show()
      $("#error").html("<b>Error:</b> The achievements for this character are not set as public.")
    }

    renderList("#arr_dungeons", arr_dungeons)
    renderList("#hw_dungeons", hw_dungeons)
    renderList("#sb_dungeons", sb_dungeons)
    renderList("#shb_dungeons", shb_dungeons)

    renderList("#arr_trials", arr_trials)
    renderList("#hw_trials", hw_trials)
    renderList("#sb_trials", sb_trials)
    renderList("#shb_trials", shb_trials)

    renderList("#arr_trials_ex", arr_trials_ex)
    renderList("#hw_trials_ex", hw_trials_ex)
    renderList("#sb_trials_ex", sb_trials_ex)
    renderList("#shb_trials_ex", shb_trials_ex)

    renderList("#arr_raids", arr_raids)
    renderList("#hw_raids", hw_raids)
    renderList("#sb_raids", sb_raids)
    renderList("#shb_raids", shb_raids)

    renderList("#arr_raids_s", arr_raids_s)
    renderList("#hw_raids_s", hw_raids_s)
    renderList("#sb_raids_s", sb_raids_s)
    renderList("#shb_raids_s", shb_raids_s)
	}
});
